# 更新日志

本文档记录了项目的所有重要变更。

格式遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [0.7.0] - 2025-01-22

### 新增
- **自定义文件类型支持** - 可以手动输入文件扩展名来过滤文件类型
- **工具函数模块** - 新增 `utils.py`，包含常用的工具函数
- **自定义异常类** - 新增 `exceptions.py`，定义完整的异常类体系
- **路径安全验证** - 添加路径遍历攻击防护
- **批量缓存查询** - 新增 `get_batch()` 方法，支持批量查询缓存

### 改进
- **性能优化**
  - 添加进程池支持，可选使用多进程替代多线程
  - 批量缓存查询性能提升 10 倍+
  - 进程池模式下性能提升 2-3 倍
  - SQLite 数据库优化（WAL 模式、复合索引）
  - 使用 `executemany` 批量插入缓存

- **错误处理**
  - 移除所有裸 `except` 语句
  - 添加具体的异常类型处理
  - 改进日志记录，添加详细的错误信息
  - 重命名 `PermissionError` 为 `PermissionErrorInfo` 避免与内置异常冲突

- **安全性**
  - 修复 `invalidate_by_prefix` 方法的 SQL 注入风险
  - 使用 GLOB 模式替代 LIKE 进行模式匹配
  - 添加输入验证
  - 限制哈希算法选择，只允许安全的算法

- **代码质量**
  - 添加完整的类型注解
  - 改进文档字符串
  - 提取重复代码到工具模块

### 修复
- 修复第二次扫描时进度条不重置的问题
- 修复 GUI 中智能选择功能的 `TypeError` 错误（QTreeWidgetItem 不可哈希）
- 修复 GitHub Actions 编译问题：
  - macOS-13 runner 已弃用，改用 macos-12
  - `libgl1-mesa-glx` 已弃用，改用 `libgl1`
  - Windows PowerShell `mkdir` 在目录已存在时报错
  - Windows 环境下的 Unicode 编码问题
  - PyInstaller 与 spec 文件冲突的选项问题

### 文档
- 更新 README.md，添加性能优化和新功能说明
- 更新 BUILD.md，添加多平台编译说明

## [0.6.0] - 2025-01-10

### 新增
- **命令行模式（CLI）** - 支持通过命令行进行扫描和导出操作
- **多平台编译** - 支持 Linux、macOS、Windows 三平台编译
- **GitHub Actions CI/CD** - 自动化编译和发布

### 改进
- **权限检查** - 预检查目录权限，提前发现无法访问的目录
- **文件预览** - 支持图片缩略图预览和文件元信息显示

### 文档
- 创建 BUILD.md 编译指南
- 更新 README.md 添加编译说明

## [0.5.0] - 2024-12-XX

### 新增
- **相似文件检测** - 基于感知哈希的图片和视频相似度检测
- **权限检查功能** - 检测并报告无权限访问的目录
- **文件预览功能** - 显示文件详细信息

### 改进
- 相似度检测支持多种哈希算法
- 可配置相似度阈值

## [0.4.0] - 2024-XX-XX

### 新增
- **预计剩余时间显示** - 实时计算并显示扫描剩余时间
- **拖拽支持** - 拖拽文件夹到窗口即可开始扫描
- **搜索和过滤功能** - 实时搜索和过滤结果
- **配置文件支持** - 保存用户偏好设置
- **日志系统** - 完整的日志记录和文件轮转

## [0.3.0] - 2024-XX-XX

### 新增
- **多阶段哈希策略** - 先部分哈希筛选，再完整哈希确认
- **批量操作增强** - 全选、反选、按目录/大小选择
- **深色模式支持** - 完整的主题切换功能

## [0.2.0] - 2024-XX-XX

### 新增
- **智能选择策略** - 多种策略自动选择要删除的重复文件
- **安全删除** - 移动到回收站而非永久删除
- **并行哈希计算** - 利用多核 CPU 加速
- **缓存机制** - SQLite 缓存哈希结果
- **导出功能** - 支持 CSV、JSON、HTML 格式

## [0.1.0] - 2024-XX-XX

### 新增
- 基本的文件扫描功能
- 重复文件检测（SHA-256）
- 手动选择和删除文件

---

## 版本说明

- **主版本号（Major）**：不兼容的 API 变更
- **次版本号（Minor）**：向下兼容的功能新增
- **修订号（Patch）**：向下兼容的问题修复
